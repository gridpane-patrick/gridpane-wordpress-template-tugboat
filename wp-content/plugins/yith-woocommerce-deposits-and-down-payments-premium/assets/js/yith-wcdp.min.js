jQuery(function(f){var m=f("form.cart"),i=f('input[name="payment_type"]'),d=f(".yith-wcdp-deposit-shipping"),r=d.find(".yith-wcdp-shipping-form"),h=null,a=function(){i.length?i.on("change",function(){var t=f(this),i=t.val();t.is(":checked")&&("deposit"===i?d.slideDown():d.slideUp())}).change():d.length&&d.slideDown()},y=function(t){d=m.find(".yith-wcdp-deposit-shipping"),i=f('input[name="payment_type"]'),d.length&&(a(),f.ajax({beforeSend:function(){d.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},complete:function(){d.unblock()},data:{product_id:t.variation_id,qty:m.find('input[name="quantity"]').val(),action:yith_wcdp.actions.calculate_shipping},dataType:"json",method:"post",success:function(t){r.find("table").html(t.template)},url:yith_wcdp.ajax_url}))};m.on("found_variation",function(t,i){var a,n,c,e=f(this),o=e.find(".woocommerce-variation-add-to-cart"),d=e.find(".yith-wcdp-single-add-to-cart-fields"),r=d.find(".full-price"),p=d.find(".deposit-price"),l=d.data("deposit-type"),s=d.data("deposit-amount"),_=d.data("deposit-rate"),u=0;yith_wcdp.ajax_variations?h=f.ajax({beforeSend:function(){null!=h&&h.abort(),e.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},complete:function(){e.unblock()},data:{variation_id:i.variation_id,variation_attr:m.find(".variations select").serializeArray().reduce((t,i)=>(t[i.name]=i.value,t),{}),action:"get_deposit_template"},dataType:"html",success:function(t){d.length&&d.parent().remove(),o.before(t),d=e.find(".yith-wcdp-single-add-to-cart-fields"),y(i),f(document).trigger("yith_wcdp_updated_deposit_form",d)},url:yith_wcdp.ajax_url}):"undefined"!=typeof i.add_deposit_to_cart?(d.length&&d.parent().remove(),o.before(i.add_deposit_to_cart),y(i),f(document).trigger("yith_wcdp_updated_deposit_form",d)):d.length&&(a=i.display_price,n="( "+accounting.formatMoney(a,{symbol:yith_wcdp.currency_format.symbol,decimal:yith_wcdp.currency_format.decimal,thousand:yith_wcdp.currency_format.thousand,precision:yith_wcdp.currency_format.precision,format:yith_wcdp.currency_format.format})+" )",u="amount"===l?Math.min(a,s):(u=a*_/100,Math.min(a,u)),c="( "+accounting.formatMoney(u,{symbol:yith_wcdp.currency_format.symbol,decimal:yith_wcdp.currency_format.decimal,thousand:yith_wcdp.currency_format.thousand,precision:yith_wcdp.currency_format.precision,format:yith_wcdp.currency_format.format})+" )",r.html(n),p.html(c),y(i),f(document).trigger("yith_wcdp_updated_deposit_form",d))}).on("reset_data",function(){var t=f("#yith-wcdp-add-deposit-to-cart");t.parents(".variations_form").length&&yith_wcdp.variations_handling&&t.remove()}).on("click",".reset_variations",function(){f("#yith-wcdp-add-deposit-to-cart").hide()}).on("click",'#yith-wcdp-add-deposit-to-cart button[name="calc_shipping"]',function(t){t.preventDefault();var i=f(this),a=f("form.cart"),n=a.find('button[name="add-to-cart"]').val(),c=a.find('input[name="variation_id"]').val(),e=i.closest(".shipping-calculator-form"),o=e.find("#calc_shipping_country").val(),t=e.find("#calc_shipping_city").val(),i=e.find("#calc_shipping_state").val(),e=e.find("#calc_shipping_postcode").val();((n=!n&&!c?a.find('input[name="add-to-cart"]').val():n)||c)&&f.ajax({beforeSend:function(){d.block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},complete:function(){d.unblock()},data:{action:yith_wcdp.actions.change_location,product_id:c||n,qty:a.find('input[name="quantity"]').val(),calc_shipping_country:o,calc_shipping_city:t,calc_shipping_state:i,calc_shipping_postcode:e},dataType:"json",method:"post",success:function(t){f(".shipping-calculator-form").slideUp("slow"),r.find("table").html(t.template),"undefined"!=typeof t.notices&&(d.prepend(f("<div>").addClass("yith-wcdp-messages").html(t.notices)).slideDown(),window.setTimeout(function(){f(".yith-wcdp-messages").slideUp("slow",function(){f(this).remove()})},3e3))},url:yith_wcdp.ajax_url})}).find("select:eq(0)").change(),f(document).on("yith_wcpb_ajax_update_price_request",function(t,i){var a=f(".yith-wcdp-single-add-to-cart-fields"),n=a.find(".full-price"),c=a.find(".deposit-price");a.length&&void 0!==i&&"undefined"!=typeof i.deposit_html&&(n.html("( "+i.price_html+" )"),c.html("( "+i.deposit_html+" )"))}),f(document).on("yith_wcevti_price_refreshed yith_wapo_product_price_updated yith_wcp_price_updated",function(t,i){var a=f(".yith-wcdp-single-add-to-cart-fields"),n=a.find(".full-price"),c=a.find(".deposit-price"),e=a.data("deposit-type"),o=a.data("deposit-amount"),d=a.data("deposit-rate"),r=i,p=0,i=f(".ywcp_wcp_group_total");a.length&&(1===i.length&&"yith_wapo_product_price_updated"===t.type||(t="( "+accounting.formatMoney(r,{symbol:yith_wcdp.currency_format.symbol,decimal:yith_wcdp.currency_format.decimal,thousand:yith_wcdp.currency_format.thousand,precision:yith_wcdp.currency_format.precision,format:yith_wcdp.currency_format.format})+" )",p="amount"===e?Math.min(r,o):(p=r*d/100,Math.min(r,p)),p="( "+accounting.formatMoney(p,{symbol:yith_wcdp.currency_format.symbol,decimal:yith_wcdp.currency_format.decimal,thousand:yith_wcdp.currency_format.thousand,precision:yith_wcdp.currency_format.precision,format:yith_wcdp.currency_format.format})+" )",n.html(t),c.html(p)))}),f(".shipping-calculator-form").hide(),a(),f(document).on("click",".shipping-calculator-button",function(){return f(".shipping-calculator-form").slideToggle("slow",function(){f("body").trigger("country_to_state_changed")}),!1})});