!function(n){var a=n("#yith-pos-store"),s=n("body").hasClass("yith-pos-store-wizard"),t=yith_pos_store_edit.post_id;s||n(document).on("submit","body.post-type-yith-pos-store form#post",function(e){n(document).trigger("yith-pos-registers-list:deleteRegisterToCreate");var t,i,r,s,o=n(e.target).find("input,select,textarea").filter(":not(.yith-pos-create-user-form__field)");o.trigger("validate_field"),(t=o.filter(".invalid")).length&&(r=(i=t.first()).closest(".tabs-panel").attr("id"),(s=a.find("ul.metaboxes-tabs li a[href=#"+r+"]"))&&s.click(),i.focus(),e.preventDefault())});var o={dom:{list:n("#yith-pos-store-metabox-registers-list"),newBtn:n("#yith-pos-store-metabox-registers-list__new"),createFormWrapper:n("#yith-pos-store-metabox-registers-list__create-form-wrapper")},init:function(){o.dom.newBtn.on("click",o.newRegisterFormHandler),o.dom.createFormWrapper.on("click",".yith-pos-register-create",o.create),o.dom.list.on("click",".yith-pos-register-update",o.update),o.dom.list.on("click",".yith-pos-register-delete",o.deleteRegister),n(document).on("yith-pos-registers-list:deleteRegisterToCreate",o.deleteRegisterToCreate),n(document).on("click",".yith-pos-register-payment-methods input[type=checkbox]",o.atLeastOnePaymentMethod),n(document).on("change keyup",".yith-pos-store-register__name-field-container",o.realtimeTitleEditing)},atLeastOnePaymentMethod:function(e){var t=n(e.target);t.closest(".yith-pos-register-payment-methods").find("input[type=checkbox]:checked").length||t.prop("checked",!0)},getRegisterToCreate:function(){var e=o.dom.createFormWrapper.find(".yith-pos-store-register").first();return!!e.length&&e},deleteRegisterToCreate:function(){o.dom.createFormWrapper.find(".yith-pos-store-register").remove()},initFields:function(){n(document.body).trigger("wc-enhanced-select-init").trigger("yith-framework-enhanced-select-init").trigger("yith-plugin-fw-metabox-init-deps")},newRegisterFormHandler:function(e){e.preventDefault(),o.dom.newBtn.is(".closed")?o.closeForm():o.openForm()},openForm:function(){var e=o.getRegisterToCreate();if(!e){var t=o.dom.newBtn.data("template");if((e=n(t)).hide(),o.dom.createFormWrapper.append(e),o.initFields(),s){var i,r=e.find(".show-cashiers-list select");n("#_cashiers option").each(function(){i=new Option(n(this).html().replace("&amp;ndash;","-"),n(this).val(),!1,!1),r.append(i)}),r.trigger("change")}}e.slideDown(),o.dom.newBtn.html(o.dom.newBtn.data("close-text")).addClass("closed")},closeForm:function(){var e=o.getRegisterToCreate();e&&e.slideUp(),o.dom.newBtn.html(o.dom.newBtn.data("text")).removeClass("closed")},serializeObject:function(e,t){var i={},r=e.serializeArray(),s=n.map(e.filter("input[type='checkbox'].on_off:not(:checked)"),function(e){return{name:n(e).attr("name"),value:n(e).val()}});return r=r.concat(s),n.each(r,function(){var e=this.name;e&&t&&(e=e.replace(t,"")),i[e]?(i[e].push||(i[e]=[i[e]]),i[e].push(this.value||"")):i[e]=this.value||""}),i},getRegisterData:function(e){var t=e.find("input,select,textarea"),i=e.data("field-name-prefix");return t.trigger("validate_field"),o.serializeObject(t,i)},addMessage:function(e,t,i){var r=n("<div class='yith-pos-admin-notice yith-pos-admin-notice--"+i+"'>"+t+"<span class='yith-pos-admin-notice__dismiss'></span></div>");e.find(".yith-pos-settings-box__content").prepend(r),yith_pos.scrollTo(e)},removeMessages:function(e){e.find(".yith-pos-admin-notice").remove()},create:function(){var i=o.getRegisterToCreate();if(i){o.removeMessages(i);var e=o.getRegisterData(i);i.find(".validate-error").length||(i.block(yith_pos.blockParams),e.action="yith_pos_create_register",e.store_id=t,e.security=yith_pos_store_edit.create_register_nonce,n.ajax({type:"POST",data:e,url:ajaxurl,success:function(e){if("undefined"!=typeof e.success&&e.success){var t=n(e.register_html);o.dom.list.append(t),o.initFields(),o.deleteRegisterToCreate(),o.closeForm(),n(document).trigger("yith_pos_register_created",[t])}else"undefined"!=typeof e.error&&o.addMessage(i,e.error,"error")},complete:function(){i.unblock(),n(document).find(".yith-pos-admin-notice").remove()}}))}},update:function(e){var t,i=n(e.target).closest(".yith-pos-store-register");i&&(o.removeMessages(i),(t=o.getRegisterData(i)).id=i.data("register-id"),i.find(".validate-error").length||(i.block(yith_pos.blockParams),t.action="yith_pos_update_register",t.security=yith_pos_store_edit.update_register_nonce,n.ajax({type:"POST",data:t,url:ajaxurl,success:function(e){"undefined"!=typeof e.success&&e.success&&"undefined"!=typeof e.message&&o.addMessage(i,e.message,"success"),"undefined"!=typeof e.error&&o.addMessage(i,e.error,"error")},complete:function(){i.unblock()}})))},deleteRegister:function(e){var t,i=n(e.target).closest(".yith-pos-store-register");i&&o.removeMessages(i),i&&window.confirm(yith_pos_store_edit.i18n_register_delete_confirmation)&&(t={id:i.data("register-id"),action:"yith_pos_delete_register",security:yith_pos_store_edit.delete_register_nonce},i.block(yith_pos.blockParams),n.ajax({type:"POST",data:t,url:ajaxurl,success:function(e){"undefined"!=typeof e.success&&e.success?(i.unblock(),i.slideUp(400,function(){i.remove()})):"undefined"!=typeof e.error&&o.addMessage(i,e.error,"error")},complete:function(){i.unblock()}}))},realtimeTitleEditing:function(e){var t=n(e.target),i=t.closest(".yith-pos-store-register").find(".yith-pos-settings-box__header .yith-pos-settings-box__title").first();i.length&&i.html(t.val())}};if(o.init(),n(document).on("change",".yith-pos-store-register .on_off, .yith-pos-store-register [type=checkbox]",function(){var e=n(this),t=e.attr("id"),i=n(document).find("[data-dep-id="+t+"]");void 0!==i&&e.is(":checked")?n(i).css({opacity:1}):n(i).css({opacity:.3})}),n(document).find(".yith-pos-store-register .on_off, .yith-pos-store-register [type=checkbox]").change(),"URLSearchParams"in window){var e=new URLSearchParams(window.location.search).get("yith-pos-edit-register"),i=n(".yith-pos-store-register[data-register-id="+e+"]");e&&i.length&&(n("#yith-plugin-fw-metabox-tab-edit_store_registers-anchor a").click(),i.find(".yith-pos-settings-box__toggle").click(),setTimeout(function(){yith_pos.scrollTo(i)},200))}}(jQuery);