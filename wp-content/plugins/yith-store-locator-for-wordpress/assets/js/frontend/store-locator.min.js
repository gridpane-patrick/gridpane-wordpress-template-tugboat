!function(m){var _={options:yith_sl_store_locator,infowindows:[],is_google_suggestion:!1,radius_default_step:yith_sl_store_locator.filter_radius_default_step,latitude:"",longitude:"",filters:{},search_bar_address:m("#yith-sl-search-bar-address"),init:function(){m(document).on("ready",_.initStoreLocator),m(document).on("click","#yith-sl-geolocation",function(e){e.preventDefault(),m("#yith-sl-wrap-loader").show(),_.useCurrentLocation()}),m(document).on("click","#yith-sl-search-icon",function(){_.getResults()}),m(document).on("click","#yith-sl-show-all-stores",_.showAllStores),m(document).on("click","#yith-sl-search-button",function(e){e.preventDefault(),_.getResults()}),m(document).on("click","#yith-sl-view-all",_.showAllResults),m(document).on("keypress",function(e){13===e.which&&_.getResults()}),m(document).on("keypress change","#yith-sl-search-bar-address",_.getResultsOnChangeAddress),"no"===_.options.autosearch&&m(document).on("click change",".wrapper-filter[data-taxonomy=yisl_radius] li, select#filter-radius",_.showTooltip),"yes"===_.options.full_width_layout&&m(window).on("resize",_.makeLayoutFullwidth),m(document).on("click","#yith-sl-main-filters-container.layout-dropdown .type-dropdown .wrapper-options label",function(){var e=m(this).parents(".wrapper-filter");e.find("li").removeClass("active"),e.find("input").removeAttr("checked"),m(this).closest("li").addClass("active"),_.initFilters()}),m(document).on("change","#yith-sl-main-filters-container select, #yith-sl-main-filters-container input",function(){_.initFilters()}),m(document).on("change","#yith-sl-main-filters-container input, select",function(){if(m(this).is("select")){var e=m(this).val();m(this).find("option[value="+e+"]").attr("selected","true")}else if(m(this).is(":checkbox")||m(this).is(":radio")){var t=m(this).is(":checked");m(this).attr("checked",t)}}),m(document).on("yith_sl_filters_initialized",function(){"yes"===_.options.autosearch&&_.getResults()}),m(document).on("click","#yith-sl-reset-all-filters",function(){_.resetFilters(),_.getResults()}),m(document).on("click","#wrapper-active-filters .remove-term",_.removeFilter),m(document).on("click","#yith-sl-open-filters",function(){m(".wrap-filters-list").slideToggle()})},initStoreLocator:function(){var e=null!==localStorage?localStorage.getItem("first_time"):null;"yes"===_.options.show_map&&_.initMap(_.latitude,_.longitude),"yes"===_.options.autogeolocation&&_.useCurrentLocation(),google.maps,google.maps.places,google.maps.places.Autocomplete,_.initSearchAddressInput(),e||localStorage.setItem("first_time","1"),1===e&&"no"===_.options.autogeolocation&&"yes"===_.options.show_stores_by_default&&_.ajax_show_all_stores(),"yes"===_.options.full_width_layout&&_.makeLayoutFullwidth(),_.initFilters()},showTooltip:function(){var e=m("#yith-sl-search-bar-address").val(),t=m(this).find("input").val(),o=m(this).val(),i=m("#address-tooltip");""===e&&(void 0!==t&&0!==t&&"selectall"!==t||void 0!==o&&0!==o&&"selectall"!==o)&&(i.fadeIn(),setTimeout(function(){i.fadeOut()},4e3))},makeLayoutFullwidth:function(){var e=m("#yith-store-locator"),t=e.outerWidth(!0),o=(m("body").width()-t)/2;e.css("margin","0 -"+o+"px"),e.css({"padding-left":_.options.left_padding_full_width_layout+"px","padding-right":_.options.right_padding_full_width_layout+"px"})},getResultsOnChangeAddress:function(e){switch(e.type){case"keypress":13===e.which&&(e.stopPropagation(),_.getAddress(_.getResults));break;case"change":_.getAddress(_.getResults)}},getAddress:function(o){var e=m("#yith-sl-search-bar-address").val();""!==e&&(geocoder=new google.maps.Geocoder,geocoder.geocode({address:e},function(e,t){0<e.length&&(_.latitude=parseFloat(e[0].geometry.location.lat()),_.longitude=parseFloat(e[0].geometry.location.lng()),_.is_google_suggestion=!1,m("#yith-sl-geolocation-enabled").val("no"),"yes"===_.options.autosearch&&o())}))},showAllResults:function(e){e.preventDefault(),m(this).fadeTo("fast",0);var t="one"===_.options.results_columns?"block":"flex";m("#yith-sl-results").find(".additional-stores").slideDown({start:function(){m(this).css({display:t})}})},showAllStores:function(e){e.preventDefault(),m("#yith-sl-search-bar-address").val(""),_.latitude="",_.longitude="",_.geolocation="no",_.resetFilters(),_.getResults(!0)},initSearchAddressInput:function(){var e=m(".yith-sl-gmap-places-autocomplete")[0],t=new google.maps.places.Autocomplete(e);google.maps.event.addListener(t,"place_changed",function(){var e=t.getPlace();void 0!==e.geometry?(_.latitude=parseFloat(e.geometry.location.lat()),_.longitude=parseFloat(e.geometry.location.lng()),_.is_google_suggestion=!0,m("#yith-sl-geolocation-enabled").val("no"),"yes"===_.options.autosearch&&_.getResults()):_.is_google_suggestion=!1})},useCurrentLocation:function(){if(!navigator.geolocation)return alert(_.options.alert_geolocalization_not_supported),void m("#yith-sl-wrap-loader").hide();navigator.geolocation.getCurrentPosition(_.geolocationSuccess,_.geolocationError,{enableHighAccuracy:!0})},geolocationSuccess:function(e){_.latitude=e.coords.latitude,_.longitude=e.coords.longitude,_.geolocation="yes";var t=new google.maps.Geocoder,o={lat:_.latitude,lng:_.longitude};t.geocode({location:o},function(e,t){if("OK"===t)if(e[0]){m("#yith-sl-wrap-loader").hide();var o=e[0].formatted_address;_.search_bar_address.val(o),"yes"===_.options.autosearch&&_.getResults()}else window.alert(_.options.geocode_no_results);else window.alert(_.options.geocode_failed_to+" "+t)})},geolocationError:function(){alert(_.options.alert_calculate_position_error),m("#yith-sl-wrap-loader").hide()},getResults:function(){var e={latitude:_.latitude,longitude:_.longitude,geolocation:_.geolocation,radius:_.filter_radius_step,filters:_.filters,action:_.options.action_get_results,context:"frontend"};_.ajaxSearchStores(e)},ajaxSearchStores:function(t){var o=m("#yith-sl-results"),i=m("#yith-sl-active-filters");m("#yith-sl-wrap-loader").show(),jQuery.ajax({type:"POST",data:t,url:_.options.ajaxurl,success:function(e){"yes"===_.options.show_results&&(o.find(".title").show(),o.find(".stores-list").html(e.results),i.html(e.active_filters),"yes"===_.options.autosearch&&m("#yith-sl-search-button").hide()),"yes"===_.options.show_map&&_.initMap(t.latitude,t.longitude,e.markers,_.options.map_zoom,t.geolocation),0<i.find("li").length&&!jQuery.isEmptyObject(_.filters)&&("no"===t.show_all||void 0===t.show_all)&&i.show(),0===i.find("li").length&&i.hide(),o.show(),m("#yith-sl-wrap-loader").hide()},complete:function(){m("#yith-sl-main-filters-container.layout-dropdown").find(".wrapper-options").hide(),"no"===_.options.show_filters_with_results&&(m("#yith-sl-main-filters-container").find(".wrap-filters-list").hide(),m("#yith-sl-open-filters").show()),m(".wrapper-filter.active").removeClass("active")},error:function(){}})},initMap:function(e,t,o,i,s){null==o&&(o=""),null==i&&(i=_.options.map_zoom),null==s&&(s="no"),""===e&&(e=_.options.map_latitude),""===t&&(t=_.options.map_longitude);var n=new google.maps.LatLngBounds,l=new google.maps.Map(document.getElementById("yith-sl-gmap"),{zoom:Number(i),mapTypeId:_.options.map_type,scrollWheelZoom:!0,styles:_.options.map_style,gestureHandling:_.options.map_scroll_type,minZoom:1}),a={};if(0!==o.length){var r=[];jQuery.each(o,function(e,t){var o=new google.maps.LatLng(t.latitude,t.longitude),i=new google.maps.Marker({position:o,map:l,title:t.name,icon:t.pin_icon});if(n.extend(i.position),"undefined"!==t.pin_modal){var s=new google.maps.InfoWindow({content:t.pin_modal});_.infowindows.push(s),i.addListener(_.options.pin_modal_trigger_event,function(e){var t="";void 0!==e&&void 0!==e.rb&&(t=Math.abs(e.rb.screenY-a.y)),_.closeAllInfoWindows(),(void 0===e||300<t)&&l.panTo(i.getPosition()),s.open(l,i)})}(r[t.id]=i).setMap(l)});var c=m(".wrap-store-details");if(c.mouseenter(function(){_.closeAllInfoWindows();var e=m(this).data("id");google.maps.event.trigger(r[e],_.options.pin_modal_trigger_event)}),c.mouseleave(function(){_.closeAllInfoWindows()}),"yes"===s){var d=new google.maps.LatLng(e,t),u=new google.maps.Marker({position:d,map:l,icon:yith_sl_store_locator.map_user_icon});n.extend(u.position)}if(n.getNorthEast().equals(n.getSouthWest())){var p=new google.maps.LatLng(n.getNorthEast().lat()+.1,n.getNorthEast().lng()+.1);n.extend(p)}if("yes"===_.options.show_circle&&_.filters.yisl_radius&&void 0!==e&&void 0!==t&&e!==_.options.map_latitude&&t!==_.options.map_longitude){var g=new google.maps.LatLng(e,t),h=new google.maps.Circle({strokeColor:_.options.circle_border_color,center:g,strokeWeight:_.options.circle_border_weight,fillColor:_.options.circle_background_color,map:l,radius:"km"===_.options.filter_radius_distance_unit?1e3*_.filters.yisl_radius:1.60934*_.filters.yisl_radius});n.union(h.getBounds())}l.fitBounds(n)}else if("yes"===_.options.show_circle&&_.filters.yisl_radius&&void 0!==e&&void 0!==t&&e!==_.options.map_latitude&&t!==_.options.map_longitude){g=new google.maps.LatLng(parseFloat(e),parseFloat(t)),h=new google.maps.Circle({strokeColor:_.options.circle_border_color,center:g,strokeWeight:_.options.circle_border_weight,fillColor:_.options.circle_background_color,map:l,radius:"km"===_.options.filter_radius_distance_unit?1e3*_.filters.yisl_radius:1.60934*_.filters.yisl_radius});l.setCenter(g)}else{var f=new google.maps.LatLng(e,t);l.setCenter(f)}},closeAllInfoWindows:function(){for(var e=0;e<_.infowindows.length;e++)_.infowindows[e].close()},initFilters:function(){var e=m("#yith-sl-main-filters-container");e.find(".wrapper-filter").each(function(){m(this).removeClass("selected");var e=jQuery(this).data("taxonomy");_.filters[e]=[]}),e.find("li.active input, input:checked, option:selected").each(function(){var e=m(this).parents(".wrapper-filter"),t=m(this).parents(".wrapper-filter").data("taxonomy"),o=m(this).val();void 0!==t&&("selectall"!==o?(e.addClass("selected"),_.filters[t].push(o)):_.filters[t]=[])}),m(document).trigger("yith_sl_filters_initialized")},resetFilters:function(){var e=m("#yith-sl-main-filters-container").find(".wrapper-filter");m(".open-dropdown").each(function(){var e=jQuery(this).data("title");m(this).find(".text").html(e)}),e.find("option:selected, input:checked").each(function(){m(this).removeAttr("selected checked")}),e.find("li.active").removeClass("active"),e.find("select").prop("selectedIndex",0),e.removeClass("selected active"),m("#yith-sl-active-filters").hide(),m(document).trigger("yith_sl_reset_filters"),_.initFilters()},removeFilter:function(){var e=m(this).data("taxonomy"),t=m(this).data("value"),o=m("#yith-sl-main-filters-container").find("[data-taxonomy='"+e+"'][data-value='"+t+"']"),i=o.parents(".wrapper-filter"),s=m(this).closest(".wrapper-terms").find("li").length;if(o.removeAttr("selected checked"),o.parents("li").removeClass("active"),i.removeClass("selected"),1<s?m(this).parent("li").remove():m(this).parents("li").remove(),o.is(":radio")){var n=i.find(".open-dropdown").data("title");i.find(".text").html(n)}_.initFilters(),0===m("#wrapper-active-filters").find("li").length&&m("#yith-sl-active-filters").hide(),"yes"===_.options.autosearch&&_.getResults()}};_.init()}(jQuery);